# Phase 6 Output: ワークフロー手順書の作成

**日付**: 2026-02-18
**Feature**: 010-pipeline-refactoring
**Phase**: Phase 6 - User Story 5 (ワークフロー手順書の作成)
**状態**: 完了

## 作業サマリー

Phase 6では、動画から電子書籍への変換を行う完全なワークフロー手順書を作成しました。このドキュメントは、エンドユーザーが各CLIコマンドを理解し、実際の運用で使用できるよう、詳細な使用例とトラブルシューティングを含んでいます。

### 完了したタスク

| タスク | 内容 | 状態 |
|--------|------|------|
| T090 | セットアップ分析読み込み | ✅ 完了 |
| T091 | 前フェーズ出力読み込み | ✅ 完了 |
| T092 | WORKFLOW.md 作成 | ✅ 完了 |
| T093 | CLIコマンド使用例追加 | ✅ 完了 |
| T094 | Markdownマーカー追加手順追加 | ✅ 完了 |
| T095 | トラブルシューティングセクション追加 | ✅ 完了 |
| T096 | 手動確認 (ドキュメントレビュー) | ✅ 完了 |
| T097 | Phase出力生成 | ✅ 完了 |

**進捗**: 8/8タスク完了

## 作成されたファイル

### ドキュメントファイル

| ファイル | 内容 | 行数 | 変更タイプ |
|----------|------|------|------------|
| `docs/WORKFLOW.md` | 完全なワークフローガイド | 842 | 新規作成 |

## ドキュメント構成

### WORKFLOW.md の内容

`docs/WORKFLOW.md` は以下のセクションで構成されています:

#### 1. 概要と前提条件

- システム要件 (Python 3.13+, メモリ, GPU)
- 環境セットアップ手順
- 入力データ準備

#### 2. ステップバイステップ・ワークフロー

各ステップごとに以下を記載:

**Step 1: フレーム抽出**
- コマンド構文と実行例
- オプション一覧 (interval)
- 出力形式
- 注意事項とチューニングのヒント

**Step 2: 重複除去**
- コマンド構文と実行例
- オプション一覧 (threshold)
- 出力形式
- 閾値チューニング (3-15の範囲)

**Step 2.5: 見開き分割 (オプション)**
- コマンド構文と実行例
- オプション一覧 (aspect-ratio, left-trim, right-trim)
- in-place更新の挙動
- 推奨アスペクト比 (書籍1.2-1.3, スライド1.7-1.8)

**Step 3: レイアウト検出**
- コマンド構文と実行例 (CPU/GPU)
- オプション一覧 (device)
- JSON出力フォーマット例
- パフォーマンス比較 (CPU: 1-3秒/ページ, GPU: 0.2-0.5秒/ページ)

**Step 4: OCR実行**
- コマンド構文と実行例 (layout-dir指定)
- オプション一覧 (layout-dir, device)
- JSON出力フォーマット例
- パフォーマンス比較 (CPU: 5-10秒/ページ, GPU: 1-2秒/ページ)

**Step 5: 統合**
- コマンド構文と実行例
- 出力形式 (book.txt, book.md)
- Markdown形式の例

#### 3. 手動ステップ

**Markdownマーカーの追加**:
1. 章・セクションマーカー (`#`, `##`)
2. 図表参照の修正 (`![図N](figures/fig_N.png)`)
3. ページ区切りの挿入 (`---`)
4. OCR誤認識の修正 (0/O, 1/l, 句読点)

**品質確認**:
- テキスト量確認コマンド (`wc -l`, `wc -m`)
- Markdown構文チェック (`markdownlint`)
- 視覚的確認のチェックポイント

#### 4. トラブルシューティング

以下の一般的な問題と解決策を記載:

| 問題 | 症状 | 解決策 |
|------|------|--------|
| 入力ファイルが見つからない | `Error: Input not found` | 絶対パス使用、ファイル存在確認 |
| OCRが非常に遅い | 10秒以上/ページ | GPU使用、メモリ確保、バッチ処理 |
| 見開き分割が不正確 | 誤分割/未分割 | アスペクト比調整 (1.1-1.8) |
| OCR結果が文字化け | 日本語誤認識 | 画像品質向上 (1920x1080推奨) |
| 重複除去が過剰 | 異なるスライドが同一判定 | 閾値を小さく (5-8) |
| モデルロード失敗 | `Error: Model load failed` | 手動ダウンロード、プロキシ設定 |

**デバッグ手法**:
- 中間ファイルの確認 (`jq`でJSON確認)
- ログ出力の有効化 (将来実装予定)

#### 5. ディレクトリ構造

処理完了後の標準構造を図示:
```
project_root/
├── input.mp4
└── output/
    ├── frames/
    ├── pages/
    ├── layout/
    ├── ocr/
    ├── book.txt
    └── book.md
```

#### 6. 一括実行スクリプト (参考)

**基本版**:
- 全ステップを順次実行
- エラー時は中断 (`set -e`)

**GPU対応版**:
- デバイス指定オプション付き
- デフォルトCUDA使用

**実行方法**:
```bash
chmod +x run_pipeline.sh
./run_pipeline.sh /path/to/video.mp4 output
```

**注意**: 実際の運用では各ステップの出力確認推奨

#### 7. Tips & ベストプラクティス

**パフォーマンス最適化**:
- GPU使用 (`nvidia-smi`で確認)
- 並列処理 (GNU Parallel)

**ディスク容量管理**:
- 不要な中間ファイル削除 (frames, layout, ocr)

**バッチ処理**:
- 複数動画の一括処理スクリプト

**バックアップ**:
- 見開き分割前のページ保存

#### 8. 関連ドキュメント

- README.md: プロジェクト概要
- YOMITOKU_ARCHITECTURE.md: アーキテクチャ詳細
- YOMITOKU_MIGRATION.md: マイグレーションガイド
- quickstart.md: クイックスタート
- cli-commands.md: CLI仕様

## ドキュメントの特徴

### 網羅性

- **6つの独立CLIコマンド** すべての使用例を記載
- **オプションパラメータ** のデフォルト値と推奨値を明記
- **出力形式** (PNG, JSON, TXT, MD) をすべて図示

### 実用性

- **実行例** はすべてコピー&ペースト可能な形式
- **トラブルシューティング** は症状→原因→解決策の3ステップ
- **チューニングのヒント** (閾値、アスペクト比、解像度) を具体的数値で提示

### 段階的学習

1. **クイックスタート**: 最小限のコマンドで動作確認
2. **詳細設定**: オプションパラメータのチューニング
3. **運用最適化**: バッチ処理、並列実行、ディスク管理

### 構造化

- **目次なし** (GitHub/VS Code Markdownプレビューで自動生成)
- **見出しレベル** は最大3階層 (`#`, `##`, `###`)
- **コードブロック** は言語指定 (```bash, ```json, ```markdown)

## 既存ドキュメントとの関係

### quickstart.md との差分

| 項目 | quickstart.md | WORKFLOW.md |
|------|---------------|-------------|
| **対象読者** | 開発者 | エンドユーザー |
| **詳細度** | 簡潔 (124行) | 詳細 (842行) |
| **トラブルシューティング** | 最小限 | 6つの問題と解決策 |
| **手動ステップ** | 簡潔 | 詳細 (Markdownマーカー4種) |
| **一括実行スクリプト** | シェルスクリプト例 | 基本版 + GPU版 |

### cli-commands.md との差分

| 項目 | cli-commands.md | WORKFLOW.md |
|------|-----------------|-------------|
| **対象読者** | 開発者 (API仕様) | エンドユーザー (使用法) |
| **形式** | 仕様書 | ガイド |
| **実行例** | 構文のみ | 実際のパス付き |
| **エラーコード** | Exit codes一覧 | エラー症状と解決策 |

### 関係性

```
WORKFLOW.md (ユーザーガイド)
    ↓ 参照
quickstart.md (クイックスタート)
    ↓ 参照
cli-commands.md (CLI仕様)
```

## 次フェーズへの引き継ぎ事項

### Phase 7 で実施すべき項目

1. **WORKFLOW.md の検証**:
   - 実際の動画ファイルでワークフロー実行
   - 各コマンドの出力確認
   - トラブルシューティング項目の動作確認

2. **docs/README.md の更新**:
   - WORKFLOW.md へのリンク追加
   - ドキュメント一覧にWORKFLOW.mdを追加

3. **quickstart.md との整合性確認**:
   - quickstart.md に WORKFLOW.md への参照を追加
   - 両者の実行例に矛盾がないか確認

### 推奨アクション (後続Issue)

1. **実行例の自動テスト**:
   - WORKFLOW.md 内のコマンド例を自動実行してテスト
   - CIでドキュメント品質を保証

2. **動画付きチュートリアル**:
   - 各ステップのスクリーンキャスト作成
   - YouTube等で公開

3. **FAQ追加**:
   - ユーザーからのフィードバックをもとにFAQセクション追加

## 実装上の問題点

なし。Phase 6の目標 (ワークフロー手順書の作成) は達成されました。

## まとめ

Phase 6 (ワークフロー手順書の作成) を完了しました。

**達成事項**:
- ✅ 842行の包括的なワークフローガイド作成
- ✅ 6つの独立CLIコマンドすべての使用例記載
- ✅ Markdownマーカー追加手順の詳細説明
- ✅ 6つの一般的問題とトラブルシューティング記載
- ✅ 一括実行スクリプト (基本版 + GPU版) 提供
- ✅ Tips & ベストプラクティス記載

**次のステップ**: Phase 7 (Polish & 旧ファイル削除) に進む準備完了。
